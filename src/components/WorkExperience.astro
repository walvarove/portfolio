---
import ReusableSection from "./ReusableSection.astro";
import jobs from "../content/jobs.json";
import { toSimpleDate } from "../content/jobs";
import { calculateDuration } from "../content/jobs";
---

<ReusableSection key="workexperience" keyComment={calculateDuration(jobs[jobs.length - 1].start, new Date().toISOString()) }>
  <div class="grid gap-3">
    {
      jobs.map((job) => {
        return (
          <div class="group relative rounded-lg border border-border bg-card/50 p-5 hover:border-cyan-400/30 hover:bg-card transition-all duration-300">
            <!-- Top row: title + duration -->
            <div class="flex items-start justify-between gap-4 flex-wrap mb-3">
              <div>
                <div class="flex items-center gap-2 mb-1">
                  <h3 class="font-semibold text-foreground text-base leading-none">
                    {job.job}
                  </h3>
                  {!job.end ? (
                    <span class="inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-mono bg-cyan-400/10 text-cyan-400 border border-cyan-400/20">
                      <span class="w-1 h-1 rounded-full bg-cyan-400 animate-pulse inline-block"></span>
                      current
                    </span>
                  ) : null}
                </div>
                <p class="text-muted-foreground text-xs font-mono">
                  <a href={job.link} target="_blank" class="hover:text-cyan-400 transition-colors">
                    {job.company}
                  </a>
                </p>
              </div>
              <div class="text-right flex-shrink-0">
                <p class="text-[10px] font-mono text-muted-foreground mt-0.5">
                    {toSimpleDate(job.start)} {job.end ? <span> - {toSimpleDate(job.end)}</span> : <span>- Present</span>}
                </p>
              </div>
            </div>

            <!-- Description -->
            <p class="text-foreground/60 text-xs leading-relaxed mb-4 font-sans">
              {job.description}
            </p>

            <!-- Tech stack tags -->
            <div class="flex flex-wrap gap-1.5">
              {job.teckStack.map((tech) => (
                <span class="px-2 py-0.5 rounded text-[10px] font-mono text-muted-foreground border border-border bg-secondary/50 hover:border-cyan-400/30 hover:text-cyan-400/80 transition-colors cursor-default">
                  {tech}
                </span>
              ))}
            </div>
          </div>
        );
      })
    }
  </div>
</ReusableSection>
